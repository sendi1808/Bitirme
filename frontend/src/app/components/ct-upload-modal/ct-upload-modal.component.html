<div class="modal-overlay">
  <div class="modal-content">
    <header class="modal-header">
      <h2>CT Taraması Yükleme</h2>
      <button type="button" class="close-button" (click)="onClose()">&times;</button>
    </header>

    <div class="modal-body">
      <div class="patient-info" *ngIf="patient">
        <h3>Hasta Bilgileri</h3>
        <div class="info-row">
          <span class="label">T.C. Kimlik No:</span>
          <span class="value">{{ patient.tcNo }}</span>
        </div>
        <div class="info-row">
          <span class="label">Ad Soyad:</span>
          <span class="value">{{ patient.name }} {{ patient.surname }}</span>
        </div>
      </div>

      <form [formGroup]="uploadForm" (ngSubmit)="upload()">
        <div class="form-group">
          <label for="file">CT Görüntüsü Seç</label>
          <input 
            type="file" 
            id="file" 
            (change)="onFileChange($event)" 
            accept=".dcm,application/dicom,image/*"
            class="form-control"
          />
          
          <div class="image-preview" *ngIf="imagePreview">
            <img [src]="imagePreview" alt="Görüntü önizleme" />
          </div>
        </div>

        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="analyzeCT()" 
          [disabled]="!uploadForm.get('file')?.value || isAnalyzing"
        >
          <span *ngIf="isAnalyzing">Analiz Ediliyor...</span>
          <span *ngIf="!isAnalyzing">CT Görüntüsünü Analiz Et</span>
        </button>

        <div class="analysis-results" *ngIf="huValue !== null || csaValue !== null">
          <h4>Analiz Sonuçları</h4>
          
          <div class="result-item" *ngIf="huValue !== null">
            <span class="result-label">HU Değeri:</span>
            <span class="result-value">{{ huValue }}</span>
          </div>
          
          <div class="result-item" *ngIf="csaValue !== null">
            <span class="result-label">CSA Değeri:</span>
            <span class="result-value">{{ csaValue }} cm²</span>
          </div>
        </div>

        <div class="form-group">
          <label for="diagnosis">Teşhis</label>
          <textarea 
            id="diagnosis" 
            formControlName="diagnosis" 
            class="form-control" 
            rows="4" 
            placeholder="Teşhisinizi buraya girin"
          ></textarea>
          <div class="error-message" *ngIf="uploadForm.get('diagnosis')?.invalid && uploadForm.get('diagnosis')?.touched">
            Teşhis alanı zorunludur
          </div>
        </div>

        <div class="form-group">
          <label for="notes">Notlar (Opsiyonel)</label>
          <textarea 
            id="notes" 
            formControlName="notes" 
            class="form-control" 
            rows="3" 
            placeholder="Eklemek istediğiniz notlar"
          ></textarea>
        </div>

        <div class="button-group">
          <button type="button" class="btn btn-secondary" (click)="onClose()">İptal</button>
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="uploadForm.invalid || !uploadForm.get('file')?.value || isUploading"
          >
            <span *ngIf="isUploading">Yükleniyor...</span>
            <span *ngIf="!isUploading">Kaydet</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div> 